<div id="sub-cover">
	<div class="main-wrap">
		<div class="show-board border trim">
		</div>
		<div class="push-board">
			<div class="tag-board-cont">
				<div class="tag-board"></div>
				<div class="push-board-set">
					<div class="ui inline loader active"></div>
				</div>
			</div
			><div class="side-board">
				<div class="push-board border">
					<div class="fake-cont"></div>
				</div>
				<div class="push-board border">
					<div class="fake-cont" style="height: 10em;"></div>
				</div>
				<div class="push-board border">
					<div class="fake-cont" style="height: 30em;"></div>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	#sub-cover {
		text-align: center;
		padding: 2rem;
	}

	#sub-cover .main-wrap {
		display: inline-block;
		width: auto;
		max-width: 100%;
	}

	#sub-cover .trim {
		overflow: hidden;
	}

	#sub-cover .fake-cont {
		height: 20rem;
		width: 100%;
		background: rgba(250, 250, 250, 1);
	}

	#sub-cover .push-board,
	#sub-cover .show-board {
		position: relative;

		width: 70rem;
		height: 20rem;
		max-width: 100%;

		text-align: left;
	}

	#sub-cover .border {
		overflow: hidden;
		border-radius: 5px;
		border: 1px solid rgba(0, 0, 0, 0.08);
		box-shadow: -1px 1px 15px rgba(0, 0, 0, 0.04);
	}

	#sub-cover .show-board {
		margin-bottom: 1rem;
	}

	#sub-cover .push-board {
		height: auto;
		margin-bottom: 1rem;
	}

	#sub-cover .tag-board-cont {
		display: inline-block;

		padding: 0;

		width: 70%;
		vertical-align: top;

		padding-right: 1rem;
	}

	#sub-cover .tag-board {
		margin-top: 1rem;
	}

	#sub-cover .side-board {
		display: inline-block;
		width: 30%;

		margin-top: 1rem;
		padding-left: 1rem;
	}

	#sub-cover .extra-margin {
		margin-top: 3rem;
		margin-bottom: 2rem;
	}

	#sub-cover .push-board-set {
		margin-top: 1rem;
		text-align: center;
	}

	#sub-cover .push-board-set>.ui.loader {
		margin-top: 2em;
	}

	@media only screen and (max-width: 768px) {
		#sub-cover {
			padding: 1rem;
		}
	}

	@media only screen and (max-width: 640px) {
		#sub-cover .tag-board-cont {
			width: 100%;
			padding-right: 0;
		}

		#sub-cover .side-board {
			display: none;
			width: 100%;
			padding-left: 0;
		}

		#sub-cover .extra-margin {
			margin-top: 1rem;
			margin-bottom: 0;
		}
	}
</style>

<script>
	function init(main, args, show, cont) {
		require([
			"com/env", "com/util", "com/pboard",
			"com/event", "com/tagbox"
		], function (env, util, pboard, event, tagbox) {
			var tbar = env.get("tbar");
			tbar.setTitle("Foci");
			// tbar.setStyle("light-simple");

			var push_board = main.find(".push-board-set");

			env.favtag(function (tags) {
				if (tags)
					tagbox.imgtag(main.find(".tag-board"), tags, {});

				show(true);
			});

			var fetch_push = (function () {
				var skip = 0;
				return function fetch_push() {
					foci.get("/event/search", { lim: 8, skip: skip }, function (suc, dat) {
						if (suc) {
							var is_right = 0;

							if (!dat.length) {
								push_board.children(".ui.loader").remove();
							}

							skip += dat.length;

							for (var i = 0; i < dat.length; i++) {
								var push = $("<div class='push-board border'></div>");
								event.showcase(push, dat[i], { imgpos: "left" });
								push_board.children(".ui.loader").before(push);
							}
						} else {
							util.emsg(dat);
						}
					});
				};
			})();

			fetch_push();
			util.scrollBottom("#part", 3, function (com) {
				fetch_push();
			});

			/* tmp settings */
			var show_board = main.find(".show-board");

			foci.get("/cover/pboard", {}, function (suc, dat) {
				if (suc) {
					var parsed = [];
					var i;


					for (i = 0; i < dat.length; i++) {
						parsed.push(dat[i] ? {
							img: foci.download(dat[i].img),
							url: dat[i].url
						} : {});
					}

					for (; i < 4; i++) {
						parsed.push({});
					}

					if (env.session()) {
						env.user(function (info) {
							if (info.level < 0) {
								pboard.init(show_board, parsed, {
									setting: true,
									setting_cb: function (n, file, url) {
										foci.encop(env.session(), {
											int: "cover",
											action: "setpboard",
											n: n, info: {
												img: file, url: "#" + url
											}
										}, function (suc, dat) {
											if (suc) {
												util.refresh();
											} else {
												util.emsg(dat);
											}
										});
									}
								});
							} else {
								pboard.init(show_board, parsed);
							}
						});
					} else {
						pboard.init(show_board, parsed);
					}
				} else {
					util.emsg(dat);
				}
			});
		});
	}
</script>
