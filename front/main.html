<!-- main portal -->
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<!-- <meta http-equiv="Pragma" content="no-cache"> -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

		<link rel="shortcut icon" href="/img/favicon.ico">
		<link rel="icon" href="/img/favicon.ico">

		<script>
			window.foci = {}; // preload foci
			window.CACHE_CONTROL = 69;
		</script>

		<!-- base library -->
		<script src="/mcom/msrc?v=0&type=js&files=/lib/jquery,/lib/require"></script>
		<link rel="stylesheet" href="/mcom/msrc?type=css&v=1&files=/css/com">

		<!-- init & preload -->
		<script>
			(function () {
				foci.version = window.CACHE_CONTROL;
				foci.config = {
					banner_min_scroll: 500, // min scroll top to trigger banner
					max_upload_size: 1024 * 1024 * 3, // 3m
				};
				
				foci.nested = top != window;
			
				require.config({
					waitSeconds: 0, // ntimeout
					urlArgs: "v=" + foci.version // one version a time, keeps the cache away~~
				});

				var debug = [
					// "tbar", "holdon", "sysmsg", "notice",
					// "parts", "pm"
					// "parts", "progress", "upload", "pboard", "util"
					// "upload", "progress"
				];

				var coms = [
					"bugi", "pm", "notice", "popselect",
					"userhunt", "trex", "parts",
					"pages", "tbar", "lang", "dragi",
					"xfilt", "waterfall", "util",
					"avatar", "env", "upload", "login",
					"map", "tagbox", "rating", "progress",
					"sortby", "editable", "tip", "lang", "club",
					"holdon", "sysmsg"
				];

				for (var i = 0; i < debug.length; i++) {
					var idx = coms.indexOf(debug[i]);
					if (idx !== -1) {
						coms.splice(idx, 1);
					}
				}

				var js = [
					"/lib/gt",
					"/lib/clipboard",
					"/lib/touch-swipe",
					"/lib/canvas-to-blob",
					"/lib/cropper",
					"/lib/sui-calendar",
					"/lib/init"
				];

				var css = [
					"/font/avenir/import",
					"/font/fontawesome/import",
					"/font/foci/import",
					"/css/sui-calendar",
					"/css/cropper",
					"/css/markdown",
					"/css/font"
				];

				// set for later loading
				$(function () {
					var src;
					var target = $("head");

					target.append(" \
						<script src='/lib/foci.js?v=" + foci.version + "'></\script> \
						<script src='/semantic/semantic.min.js?v=1'></\script> \
						<!-- baidu map --> \
						<script> \
							(function() { \
								window.HOST_TYPE = '2'; \
								window.BMap_loadScriptTime = (new Date).getTime(); \
							})(); \
						</\script> \
						<script async src='https://api.map.baidu.com/getscript?v=2.0&ak=B4lBjPwv47t4CNlFiyY4siyy&services='></\script> \
					");

					src = "/mcom/merge?v=" + foci.version + "&coms=" + coms.join(",");
					target.append("<script src='" + src + "'></\script>");

					// prevent priority overwriting
					target.append("<link rel='stylesheet' href='/semantic/semantic.min.css?v=1'>");

					src = "/mcom/msrc?type=css&v=" + foci.version + "&files=" + css.join(",");
					target.append("<link rel='stylesheet' href='" + src + "'>");

					src = "/mcom/msrc?type=js&v=" + foci.version + "&files=" + js.join(",");
					target.append("<script src='" + src + "'></\script>");
				});
			})();
		</script>

		<style>
			body {
				font-size: 14px !important;
				
				line-height: normal !important;
				overflow: hidden;

				background: rgba(255, 255, 255, 1);
				
				transition: padding 0.2s;
			}

			#main {
				position: relative;
				height: 100%;
				width: 100%;
			}

			#search, #part {
				position: absolute;

				top: 0;
				left: 0;

				width: 100%;
				height: 100%;

				overflow: auto;
				overflow-x: hidden;
			}
		</style>
	</head>

	<body class="padding-tbar">
		<div id="main">
			<div id="platform"></div>
			<div id="part"></div>
			<div id="search"><div id="search-cont"></div></div>
		</div>

		<div id="main-loader" class="uix active large loader">
			<svg class="circle" viewBox="20 20 60 60">
				<circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="12" stroke-miterlimit="10"/>
			</svg>
		</div>

		<div id="preload-mod"></div>
	</body>
</html>
