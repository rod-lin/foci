<div class="sub-clubcent"> <!-- club center -->
    <!-- <div class="float-cont padding-tbar">
        <div class="bg"></div>
    </div> -->
    <div class="main-scroll">
        <div class="info-header">
            <div class="shadow"></div>
            <div class="bg"></div>
            <div class="info">
                <div class="cont-width">
                    <div class="info-cont">
                        <div class="logo field-logo"></div>
                        <div class="info-box">
                            <div class="field-dname dname"></div>
                            <div class="stat">
                                <span class="stat-item"><i class="student icon"></i> <span class="field-school"></span></span>
                                <span class="stat-item"><i class="user outline icon"></i> <span class="field-member-count"></span> member(s)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="nav-bar">
            <div class="cont-width">
                <div style="display:inline-block; padding-right: 1rem;">
                    <div class="ui secondary menu">
                        <a class="item item-event"><i class="calendar icon"></i>Events</a>
                        <a class="item item-forum only-member"><i class="talk outline icon"></i>Forum</a>
                        <a class="item item-member"><i class="user outline icon"></i>Members</a>
                        <a class="item item-setting only-member"><i class="setting icon"></i>Settings</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="tabs cont-width">
            <!-- events -->
            <div class="tab org-event-tab">
                <div class="org-event-cont"></div>
                <div class="ui loader"></div>
            </div>
            
            <!-- forum -->
            <div class="tab"></div>
            
            <!-- members -->
            <div class="tab member-tab"></div>
            
            <!-- settings -->
            <div class="tab"></div>
        </div>
    </div>
</div>

<style>
    .sub-clubcent {
    }
    
    .sub-clubcent .main-scroll {
        text-align: center;
        position: relative;
        
        background: rgba(253, 253, 253, 1);
    }
    
    .sub-clubcent .main-scroll .info-header {
        position: relative;
        
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        width: 100%;
        
        height: 20rem;
        
        text-align: center;
    }
    
    .sub-clubcent .main-scroll .info-header .info {
        position: absolute;
        
        bottom: 0;
        left: 0;
        
        width: 100%;
        padding: 2rem 0;
    }
    
    .sub-clubcent .main-scroll .info-header .info .logo {
        display: inline-block;
        
        width: 10rem;
        height: 10rem;
        
        border-radius: 5px;
        
        margin-right: 2rem;
        
        background-color: rgba(250, 250, 250, 1);
        background-repeat: no-repeat;
        background-position: center;
        background-size: cover;
        
        vertical-align: top;
        
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }
    
    .sub-clubcent .main-scroll .info-header .info .info-box {
        display: inline-block;
        color: white;
        
        overflow: hidden;
        
        -webkit-box-flex: 1;
    	-ms-flex: 1;
    	flex: 1;
    }
    
    .sub-clubcent .main-scroll .info-header .info .info-box .dname {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 1rem;
        
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .sub-clubcent .main-scroll .info-header .info .info-box .stat {

    }
    
    .sub-clubcent .main-scroll .info-header .info .info-box .stat-item {
        margin-right: 0.5rem;
    }
    
    .sub-clubcent .main-scroll .info-header .info .info-cont {
        display: -webkit-flex;
        display: flex;
        
        -webkit-box-align: center;
    	-ms-flex-align: center;
    	align-items: center;
    }
    
    .sub-clubcent .main-scroll .info-header .shadow {
        position: absolute;
        height: 100%;
        width: 150%;
        
        left: -25%;
        top: 0;
        
        background: rgba(0, 0, 0, 0.6);
        /* box-shadow: 0 5rem 3rem rgba(0, 0, 0, 0.4); */
    }
    
    .sub-clubcent .main-scroll .info-header .bg {
        width: 100%;
        height: 100%;
        
        background-image: url("img/cover/5.jpg");
        background-repeat: no-repeat;
        background-position: center;
        background-size: cover;
    }
    
    .sub-clubcent .main-scroll .nav-bar {
        width: 100%;
        
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        padding: 1rem 0;
        background: rgb(252, 252, 252);
        
        overflow: auto;
        overflow-y: hidden;
        
        transition: padding 0.2s;
    }
    
    .sub-clubcent .main-scroll .nav-bar.floating {
        position: fixed;
        top: 4.7rem;
        left: 0;
        
        z-index: 3;
        
        /* padding: 0.5rem 0; */
    }
    
    .sub-clubcent .main-scroll .nav-bar .ui.secondary.menu a {
        color: rgb(70, 70, 70);
    }
    
    .sub-clubcent .main-scroll .tabs {
    }
    
    .sub-clubcent .main-scroll .tabs .tab {
        position: relative;
        
        text-align: left;
        padding: 2rem 0;
    }
    
    .sub-clubcent .main-scroll .tabs .tab.org-event-tab {
        padding: 0;
    }
    
    .sub-clubcent .main-scroll .tabs .org-event-cont.hide {
        display: none;
    }
    
    .sub-clubcent .cont-width {
        display: inline-block;
        width: 70rem;
        max-width: 100%;
        text-align: left;
        
        padding: 0 1rem;
    }
    
    .sub-clubcent:not(.member) .only-member {
        display: none !important;
    }
    
    .sub-clubcent:not(.admin) .only-admin {
        display: none !important;
    }
    
    @media only screen and (max-width: 640px) {
        .sub-clubcent .main-scroll .info-header {
            height: 15rem;
        }
        
        .sub-clubcent .main-scroll .info-header .info {
            padding: 1rem 0;
        }
        
        .sub-clubcent .main-scroll .info-header .info .logo {
            width: 5rem;
            height: 5rem;
            margin-right: 1rem;
        }
        
        .sub-clubcent .main-scroll .info-header .info .info-box .dname {
            font-size: 1.4rem;
            margin-bottom: 0;
        }
        
        .sub-clubcent .main-scroll .info-header .info .info-box .stat-item {
            display: block;
        }
        
        .sub-clubcent .main-scroll .tabs .tab {
            padding: 1rem 0;
        }
        
        .sub-clubcent .main-scroll .tabs .tab.member-tab {
            padding-bottom: 7rem; /* to leave enough space for the avatar */
        }
    }
</style>

<script>
    function init(main, args, show, cont, exit, penv) {
        require([
            "com/env", "com/util", "com/login",
            "com/tab", "com/club", "com/event",
            "com/lang"
        ], function (env, util, login, tab, club, event, lang) {
            if (!args || !args.length) {
				util.emsg("require one argument");
				return;
			}
            
            var cuid = parseInt(args[0]);
            var m = lang.msg;
            
            if (isNaN(cuid)) {
				util.emsg("illegal club id");
				return;
			}
            
            function render(info) {
                var parsed = club.parseInfo(info);
                var info_dom = main.find(".info");
                
                tbar.setTitle("Club", parsed.dname);
            
                info_dom.find(".field-dname").html(parsed.dname);
                info_dom.find(".field-school").html(parsed.school);
                info_dom.find(".field-member-count").html(parsed.member_count);
                
                util.bgimg(info_dom.find(".field-logo"), parsed.logo);
                
                var float_bar = null;
            
                function scrollEffect() {
                    var top = penv.part.scrollTop();
                    
                    var bar_height = tbar.height();
                    var dist = main.find(".info-header").height() - bar_height;
                    
                    if (top < dist) {
                        tbar.setStyle("simple");
                        main.find(".nav-bar").removeClass("floating");
                        // main.find(".tabs").css("margin-top", "");
                        if (float_bar) {
                            float_bar.remove();
                            float_bar = null;
                            
                            // sync menu items
                            main_tab.setMenu(main.find(".nav-bar .item"));
                        }
                    } else {
                        // scroll reaches menu
                        if (float_bar) return;
                        
                        tbar.setStyle("");
                        float_bar = main.find(".nav-bar").clone().addClass("floating");
                        main.find(".nav-bar").after(float_bar);
                        
                        // rebind menus
                        main_tab.bind(float_bar.find(".item"));
                        main_tab.setMenu(float_bar.find(".item"));
                        
                        // the page may be stuck when scrolling slowly using this margin method
                        // main.find(".tabs").css("margin-top", main.find(".nav-bar").outerHeight() + "px");
                    }
                }
            
                // scroll effect
                penv.part.scroll(scrollEffect).scroll();
                
                exit(function () {
                    penv.part.off("scroll", null, scrollEffect)
                });
                
                main.find(".tabs .tab").on("tab:show", function () {
                    if (main.find(".nav-bar").hasClass("floating")) {
                        penv.part.scrollTop(main.find(".info-header").height() - tbar.height() + 1);
                    }
                });
                
                var event_tab = event.init(main.find(".org-event-cont"), {
                    view: function (info) {
                        util.jump("#event/" + info.euid);
                    },
                    
                    fetch: {
                        fetch: function (skip, sortby, cb) {
                            foci.get("/club/org", $.extend({ cuid: cuid, skip: skip }, sortby), cb);
                        },

                        cont: penv.part,
                        no_more_prompt: "no more events"
                    }
                });
                
                main.find(".org-event-tab").on("tab:show", function () {
                    main.find(".org-event-cont").addClass("hide");
                    main.find(".org-event-tab .loader").addClass("active");
                    
                    event_tab.clear(function () {
                        event_tab.fetch(function () {
                            main.find(".org-event-cont").removeClass("hide");
                            main.find(".org-event-tab .loader").removeClass("active");
                            
                            setTimeout(function () {
                                event_tab.update();
                            }, 0);
                        });
                    });
                });
                
                var main_tab = tab.common(main.find(".nav-bar .item"), main.find(".tabs .tab"));
            
                $(window).resize(function () {
                    main.find(".tabs>.tab").css("min-height",
                                                $(window).height() -
                                                tbar.height() -
                                                main.find(".nav-bar").outerHeight(true) + 2);
                }).resize();
                
                if (env.session()) {
                    foci.encop(env.session(), {
                        int: "club",
                        action: "relation",
                        cuid: cuid
                    }, function (suc, dat) {
                        if (suc) {
                            switch (dat) {
                                case "admin":
                                case "creator":
                                    main.addClass("admin");
                                
                                case "member":
                                    main.addClass("member");
                                    break;
                                
                                default: ;
                            }
                        } else {
                            util.emsg(dat);
                        }
                    });
                }
                
                if (args[1])
                    main.find(".item-" + args[1]).click();
                    
                main.find(".item-setting").attr("href", "#setting/club/" + cuid);
            }
            
            var tbar = env.get("tbar");
            
            $("body").removeClass("padding-tbar");
            // tbar.applyShadow();
            
            tbar.setTitle("Club");
            
            foci.get("/club/info", { cuid: cuid }, function (suc, dat) {
                if (suc) {
                    render(dat);
                } else {
                    util.emsg(dat);
                }
                
                show(suc);
            });
            
            club.memlist(main.find(".member-tab"), cuid, {
                use_dragi: foci.use_dragi
            });
        });
    }
</script>
