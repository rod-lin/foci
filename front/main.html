<!-- main portal -->
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Pragma" content="no-cache">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

		<script src="lib/foci.js"></script>
		<script src="lib/vcent.js"></script>
		<script src="lib/require.js"></script>

		<link rel="stylesheet" href="font/fontawesome/import.css">
		<link rel="stylesheet" href="font/ubuntu/import.css">
		<link rel="stylesheet" href="font/alegreya/import.css">

		<link rel="stylesheet" href="/semantic/semantic.min.css">
		<script src="/semantic/semantic.min.js"></script>

		<link rel="stylesheet" href="css/com.css">

		<!-- <link rel="stylesheet" href="com/tbar/import.css">
		<link rel="stylesheet" href="com/waterfall/import.css">
		<link rel="stylesheet" href="com/xfilt/import.css">
		<link rel="stylesheet" href="com/event/import.css"> -->

		<style>
			body {
				font-family: Ubuntu;
				line-height: normal;
				overflow: hidden;

				background: white;
			}

			#main {
				position: relative;
				height: 100%;
				width: 100%;
			}

			#search, #part {
				position: absolute;

				top: 0;
				left: 0;

				width: 100%;
				height: 100%;

				overflow: auto;
				overflow-x: hidden;
			}

			#cover {
				position: fixed;
				left: 0;
				top: 0;
				height: 100%;
				width: 100%;

				background-image: url("img/cover1.jpg");
				background-repeat: no-repeat;
				background-size: cover;
				background-position: 50% 50%;

				opacity: 1;

				transition: opacity 0.3s;
			}

			#cover .headline {
				font-size: 5em;
				margin-top: -1.5em;
				font-weight: bold;
				color: white;
				text-align: center;
			}
		</style>
	</head>

	<body class="padding-tbar">
		<div id="main">
			<div id="search">
				<!-- <div class="header">
					<div class="ui breadcrumb" style="margin-top: 20px;">
						<div class="active section"></div>
					</div>
				</div> -->
				<div id="search-cont"></div>
			</div>

			<div id="cover" style="opacity: 0;"></div>

			<div id="part"></div>
		</div>

		<div id="main-loader" class="ui active large loader"></div>

		<!-- <div id="frame" style="height: 100px; width: 200px; background: white;"></div> -->

		<!-- <div class="frame", style="width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: #FFF;"></div> -->

		<script>
			require([ "com/frame" ], function (frame) {
				// var fr = frame.init("#frame");
				// fr.open("main.html");
			});

			require([
				"com/tbar", "com/event", "com/env",
				"com/util", "com/pages", "com/parts",
				"com/lang", "com/formi"
			], function (tbar, event, env, util, pages, parts, lang, formi) {
				lang.loadDict("english", util);

				var cover = [ "img/cover1.jpg", "img/cover2.jpg", "img/cover3.jpg" ].choose();
				$("#cover").css("background-image", "url(" + cover + ")");

				env.init(function () {
					// map.init();
					// console.log(lang.expand("hola"));

					// formi.modal({
					// 	name: "staff register",
					// 	block: [
					// 		{
					// 			name: "Basic info",
					// 			field: [
					// 				[
					// 					{
					// 						name: "lala",
					// 						input: {
					// 							type: "text",
					// 							name: "first_name",
					// 							placeholder: "First name"
					// 						}
					// 					},

					// 					{
					// 						name: "lolo",
					// 						input: {
					// 							type: "text",
					// 							name: "last_name",
					// 							placeholder: "Last name"
					// 						}
					// 					}
					// 				],

					// 				{
					// 					sub: [
					// 						{
					// 							input: {
					// 								type: "check",
					// 								name: "ischild",
					// 								placeholder: "I'm a child",
					// 								label: "ha"
					// 							}
					// 						},

					// 						{
					// 							input: {
					// 								type: "check",
					// 								name: "ischild",
					// 								placeholder: "I'm a child",
					// 								label: "ha"
					// 							}
					// 						}
					// 					]
					// 				}
					// 			]
					// 		},

					// 		{
					// 			name: "Contact",
					// 			field: [
					// 				{
					// 					name: "Phone",
					// 					input: {
					// 						type: "text"
					// 					}
					// 				},

					// 				{
					// 					name: "Other",
					// 					input: {
					// 						type: "textarea"
					// 					}
					// 				}
					// 			]
					// 		}
					// 	]
					// });

					var bar = tbar.init();

					env.store("tbar", bar);

					bar.menu(function () {
						if (!window.location.hash) {
							pg.toggle("cover", "search");
						} else {
							util.jump("#");
						}
					});

					bar.profile(function () {
						util.jump("#profile");
					});

					util.scroll("#search, #part", function (n) {
						if (n > 0) {
							bar.showBanner();
						} else {
							bar.hideBanner();
						}
					});

					var cover_loaded = false;
					var pg = pages.init({
						"search": {
							page: "#search",
							onShow: function () {
								bar.setTitle("Search");
								bar.delSimple();
							}
						},
						
						"cover": {
							page: "#cover",
							onShow: function () {
								bar.setTitle("Foci");
								bar.setSimple();
							},

							onLoad: function (show) {
								if (cover_loaded) {
									show();
								} else {
									$("#cover").off("ready").ready(function () {
										setTimeout(function () {
											$("#main-loader").removeClass("active");
											show();
											cover_loaded = true;
										}, 2000);
									});
								}
							}
						},

						"part": {
							page: "#part",
							onShow: function () {
								bar.delSimple();
							}
						},
					}, { init: "cover" });

					var orig = null;

					var pt = parts.init("#part", {
						onJump: function (notmain) {
							bar.hideBanner();
							$("body").addClass("padding-tbar");

							if (notmain) {
								bar.delSimple();
								$("#main-loader").removeClass("active");
								orig = pg.cur();
								pg.to("part");
							} else {
								pg.to(orig || "cover");
							}
						}
					});

					/* test */
					// pt.load("profile");
					// bar.delSimple();
					// pg.to("part");
					/* test */

					var ev = event.init("#search>#search-cont", {
						onUpdate: function (pos) {},
						fetch: {
							fetch: function (skip, cb) {
								foci.get("/event/search", $.extend({ skip: skip }, cur_query), cb);
							},

							cont: "#search",
							no_more_prompt: "no more results"
						},

						loader_only_on_buffer: true
					});

					bar.search(function (query, cb) {
						research(query, cb);
					});

					// re-search
					function research(query, cb) {
						util.jump("#");
						orig = "search";
						pg.to("search");

						ev.clear(function () {
							bar.setTitle("Search results", query.kw);

							$("#search").scrollTop(0);
							cur_query = query;
							// alert("fetch");
							ev.fetch(function () {
								cb();
							});
						});
					}
				});
			});
		</script>
	</body>
</html>
