<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Pragma" content="no-cache">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
	</head>
	
	<body>
		user name <input id="login-lname"><br>
		password <input id="login-passwd"><br>
		<button id="login-submit">login</button><br>
		<span id="login-sid"></span>
		
		<br><br>

		age <input id="login-info-age"><br>
		intro <input id="login-info-intro"><br>
		school <input id="login-info-school"><br>
		<button id="login-set-info">set info</button>
		<button id="login-get-info">get info</button><br>
		<span id="login-info-res"></span>

		<br><br>

		tag <input id="login-tag"><br>
		<button id="login-set-tag">set tag</button>
		<button id="login-get-tag">get tag</button><br>
		<span id="login-tag-res"></span>

		<script src="fcauth.js"></script>
		<script>
			"use strict";

			var gsession = null;

			$("#login-submit").click(function () {
				var lname = $("#login-lname").val();
				var passwd = $("#login-passwd").val();

				FCAuth.login(lname, passwd, function (suc, session) {
					if (suc) {
						gsession = session;
						$("#login-sid").html(session[0] + ": " + session[1]);
					} else {
						$("#login-sid").html("error: " + session);
					}
				});
			});

			FCAuth.qlogin(function (suc, session) {
				if (suc) {
					gsession = session;
					$("#login-sid").html(session[0] + ": " + session[1]);
				} else {
					$("#login-sid").html("error: " + session);
				}
			});

			$("#login-get-info").click(function () {
				if (!gsession) {
					$("#login-info-res").html("login first");
					return;
				}

				FCAuth.encop(gsession, { int: "info", action: "get" }, function (suc, dat) {
					if (suc) {
						$("#login-info-res").html(JSON.stringify(dat));
					} else {
						$("#login-info-res").html(dat);
					}
				});
			});

			$("#login-set-info").click(function () {
				if (!gsession) {
					$("#login-info-res").html("login first");
					return;
				}

				FCAuth.encop(gsession, {
					int: "info",
					action: "set",
					age: $("#login-info-age").val(),
					intro: $("#login-info-intro").val(),
					school: $("#login-info-school").val()
				}, function (suc, dat) {
					if (suc) {
						$("#login-info-res").html("success");
					} else {
						$("#login-info-res").html(dat);
					}
				});
			});

			$("#login-get-tag").click(function () {
				if (!gsession) {
					$("#login-tag-res").html("login first");
					return;
				}

				FCAuth.encop(gsession, { int: "tag", action: "get" }, function (suc, dat) {
					if (suc) {
						$("#login-tag-res").html(JSON.stringify(dat));
					} else {
						$("#login-tag-res").html(dat);
					}
				});
			});

			$("#login-set-tag").click(function () {
				if (!gsession) {
					$("#login-tag-res").html("login first");
					return;
				}

				FCAuth.encop(gsession, {
					int: "tag",
					action: "set",
					tag: $("#login-tag").val()
				}, function (suc, dat) {
					if (suc) {
						$("#login-tag-res").html("success");
					} else {
						$("#login-tag-res").html(dat);
					}
				});
			});
		</script>
	</body>
</html>
