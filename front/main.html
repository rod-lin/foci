<!-- main portal -->
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Pragma" content="no-cache">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

		<script src="lib/foci.js"></script>
		<script src="lib/vcent.js"></script>
		<script src="lib/require.js"></script>

		<link rel="stylesheet" href="font/fontawesome/import.css">
		<link rel="stylesheet" href="font/ubuntu/import.css">
		<link rel="stylesheet" href="font/alegreya/import.css">

		<link rel="stylesheet" href="css/com.css">

		<link rel="stylesheet" href="/semantic/semantic.min.css">
		<script src="/semantic/semantic.min.js"></script>

		<!-- <link rel="stylesheet" href="com/tbar/import.css">
		<link rel="stylesheet" href="com/waterfall/import.css">
		<link rel="stylesheet" href="com/xfilt/import.css">
		<link rel="stylesheet" href="com/event/import.css"> -->

		<style>
			body {
				font-family: Ubuntu;
				line-height: normal;
			}

			body.no-scroll {
				overflow: hidden;
			}

			#cont {
				width: 100%;
			}

			#showcase {
				position: fixed;
				left: 0;
				top: 0;
				height: 100%;
				width: 100%;

				background-image: url("img/cover1.jpg");
				background-repeat: no-repeat;
				background-size: cover;
				background-position: 50% 50%;

				opacity: 1;

				transition: opacity 0.3s;
			}

			#showcase .headline {
				font-size: 5em;
				margin-top: -1.5em;
				font-weight: bold;
				color: white;
				text-align: center;
			}

			#showcase.hide {
				opacity: 0;
				pointer-events: none;
			}

			#loader {}

			#bottom-bar {
				padding-top: 1em;
				padding-bottom: 2em;
			}

			#result {
				text-align: center;
				color: #D9D9D9;
				font-weight: bold;
			}
		</style>
	</head>

	<body class="padding-tbar">
		<div id="cont">
			<div class="header">
				<!-- <div class="ui breadcrumb" style="margin-top: 20px;">
					<div class="active section"></div>
				</div> -->
			</div>
		</div>
		<div id="bottom-bar">
			<div id="loader" class="ui active centered inline loader" style="display: none;"></div>
			<div id="result" style="display: none;">no result</div>
		</div>

		<div id="showcase">
		</div>

		<!-- <div class="frame", style="width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: #FFF;"></div> -->

		<script>
			require([ "com/tbar", "com/event", "com/env", "com/upload", "com/util" ], function (tbar, event, env, upload, util) {
				env.init(function () {
					var bar = tbar.init();

					bar.style("simple");

					function hideCover() {
						bar.style("");
						bar.icon("idea");
						$("#showcase").addClass("hide");
						$("body").removeClass("no-scroll");
					}

					function toggleCover() {
						bar.toggleStyle("simple");
						bar.toggleIcon("idea");
						$("#showcase").toggleClass("hide");
						$("body").toggleClass("no-scroll");
					}

					function showLoader() {
						$("#loader").css("display", "");
					}

					function hideLoader() {
						$("#loader").css("display", "none");
					}

					function showResult(msg) {
						$("#result")
							.html(msg)
							.css("display", "");
					}

					function hideResult() {
						$("#result").css("display", "none");
					}

					bar.clickMenu(function () {
						toggleCover();
					});

					// upload.init();
					// event.qview();

					var ev = event.init("#cont", {
						onUpdate: function (pos) {
							$("body>.cont>.header")
								.css("padding-left", pos.left + "px")
								.css("padding-right", pos.left + "px");
						}
					});

					function setBreadcrumb(kw) {
						$("#cont>.header .section").html("Search result(s) for: <a>" + kw + "</a>");
					}

					var cur_count, maxn = 2;
					var cur_query;

					function search(query, clear, cb) {
						if (clear) cur_count = 0;

						if (!query) {
							if (cur_query) {
								query = cur_query;
							} else {
								cb(false);
								return;
							}
						} else cur_query = query;

						$.extend(query, { n: maxn, skip: cur_count });

						foci.get("/event/search", query, function (suc, dat) {
							if (suc) {
								cur_count += dat.length;
								for (var i = 0; i < dat.length; i++) ev.add(dat[i]);
								cb(dat.length != 0);
							} else {
								util.qmsg(dat);
								cb(false);
							}
						});
					}

					var no_refresh = false;

					$(window).scroll(function () {
						if (no_refresh) return;

						if ($(window).scrollTop() >= ($(document).height() - $(window).height())) {
							showLoader();
							hideResult();

							$(window).scrollTop($(document).height() - $(window).height());
							search(null, false, function (suc) {
								hideLoader();

								if (!suc) {
									showResult("no result");
									no_refresh = true;
								}
							});
						}
					});

					bar.search(function (query, cb) {
						research(query, cb);
					});

					// re-search
					function research(query, cb) {
						hideResult();
						hideCover();

						ev.clear(function () {
							$(window).scrollTop(0);
							ev.hide(function () {
								search(query, true, function (suc) {
									ev.show();

									if (!suc) {
										showResult("no result");
									}

									no_refresh = false;

									cb();
								});
							});
						});
					}
				});
			});

			require([ "com/frame" ], function (frame) {
				// var f = frame.init(".frame");
				// f.open("https://pan.baidu.com");
			});

			// wf1.add("<span>hi</span>");
		</script>
	</body>
</html>
