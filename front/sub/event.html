<div class="sub-event">
	<div class="cont">
		<!-- <div class="tcover"></div> -->
		<div class="cont-box">
			<div class="box">
				<div class="scover">
					<button class="ui blue button view-cover-btn">View cover</button>
				</div>
				<div class="info-box">
					<div class="toolbar">
						<i class="share alternate icon share-toolbtn toolbtn"></i>
						<i class="setting icon setting-toolbtn only-event-admin toolbtn"></i>
						<i class="horizontal ellipsis icon more-toolbtn toolbtn"></i>
					</div>
					<div class="title"></div>
					<!--div class="location"><i class="map outline icon"></i><span></span></div>
					<div class="date"><i class="calendar outline icon"></i><span></span></div -->
					<div class="tagbox"></div>
					<div class="descr"></div>
					<div class="col-shadow">
						<div class="show-more-btn lang" data-replace='$front.sub.event.show_more'>More</div>
					</div>
				</div>
			</div>
			<div class="box pad" style="margin-top: 1rem;">
				<div class="sub-title lang" data-replace="$front.sub.event.detail">Detail</div>
				<div class="detail">
					<img class="com-util-cont-fill" src="img/paragraph.png"></img>
				</div>
			</div>
			<div class="box bmap-cont" style="margin-top: 1rem; overflow: hidden;">
				<div class="dimmable bmap-box">
					<div class="ui ll dimmer">
						<div class="content">
							<div class="center">
								<div class="ui inverted button view-btn lang" data-replace="$front.sub.event.view">View</div>
							</div>
						</div>
					</div>
					<div class="bmap"></div>
				</div>
			</div>

			<style>

				.sub-event>.cont .row {}

				.sub-event>.cont .col {
					display: inline-block;
					vertical-align: top;
					padding-right: 0.5rem;
					margin-top: 1rem;
				}

				.sub-event>.cont .col:last-child {
					padding-right: 0;
					padding-left: 0.5rem;
				}

				.sub-event>.cont .col-7 {
					width: 70%;
				}

				.sub-event>.cont .col-3 {
					width: 30%;
				}

				@media only screen and (max-width: 720px) {
					.sub-event>.cont .col-mid-full {
						padding: 0 !important;
						width: 100%;
					}
				}

				.ui.active.loader+span {
					opacity: 0;
				}
				
				.sub-event .org .com-avatar {
					margin-right: 1.5rem;
				}

			</style>

			<div class="row">
				<div class="col col-7 col-mid-full">
					<div class="box pad" style="padding-bottom: 3rem;">
						<div class="sub-title lang" data-replace="$front.sub.event.organizers">Organizers</div>
						<div class="org" style="margin-top: 1.5rem;">
							<img class="com-util-cont-fill" src="img/paragraph.png"></img>
						</div>
					</div>
					<div class="box pad" style="margin-top: 1rem; padding-bottom: 3rem;">
						<div class="sub-title">Clubs</div>
						<div class="club-set" style="margin-top: 1.5rem;"></div>
					</div>
				</div><div class="col col-3 col-mid-full box-set app-box">
					<div class="box pad">
						<div class="apply-prompt"></div>
					</div>
					<div class="box pad apply-appcent btn always-enable" style="margin-top: 0.2rem; background: #7F8C8D; color: white; display: none;">
						<div class="ui inverted loader"></div>
						<span class="lang" data-replace="$front.sub.event.app_cent">Application center</span>
					</div>
					<div class="box pad apply-setting btn always-enable" style="margin-top: 0.2rem; background: #7F8C8D; color: white; display: none;">
						<div class="ui inverted loader"></div>
						<span class="lang" data-replace="$front.sub.event.event_setting">Settings</span>
					</div>
					<div class="box pad apply-terminate btn always-enable" style="margin-top: 0.2rem; background: #7F8C8D; color: white; display: none;">
						<div class="ui inverted loader"></div>
						<span class="lang" data-replace="$front.sub.event.term_event">End event</span>
					</div>
					<div class="box pad apply-staff btn" style="margin-top: 0.2rem; background: #3498DB; color: white;">
						<div class="ui inverted loader"></div>
						<span class="lang" data-replace="$front.sub.event.staff">Staff</span>
					</div>
					<div class="box pad apply-partic btn" style="margin-top: 0.2rem; background: #2ECC71; color: white;">
						<div class="ui inverted loader"></div>
						<span class="lang" data-replace="$front.sub.event.partic">Participant</span>
					</div>
				</div>
			</div>

			<div style="overflow: hidden; padding: 0 5% 4px 5%; width: 110%; margin-left: -5%;">
				<div class="box" style="margin-top: 1rem; width: 100%;">
					<div class="sub-title lang" data-replace="$front.sub.event.comments" style="padding: 2rem 2rem 0 2rem;">Comments</div>
					<div class="comment" style="margin-top: 1rem;">
						<!-- <img class="com-util-cont-fill" src="img/paragraph.png"></img>
						<img class="com-util-cont-fill" src="img/paragraph.png"></img>
						<img class="com-util-cont-fill" src="img/paragraph.png"></img> -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="ui large loader active"></div>
	<div class="cover">
		<div class="shadow"></div>
		<div class="shadow"></div>
		<div class="shadow"></div>
		<div class="shadow"></div>
		<div class="shadow"></div>
		<div class="shadow"></div>
		<div class="shadow"></div>
		<div class="shadow"></div>
		<div class="shadow"></div>
		<div class="left-corner">
			<div class="date"><i class="calendar icon"></i><span>loading</span></div>
			<div class="location"><i class="map icon"></i><span>loading</span></div>
			<div class="title">(untitled)</div>
			<div class="tip lang" data-replace="$front.sub.event.click_for_more">Click for more</div>
		</div>
		<!-- <div class="ui loader active"></div> -->
	</div>
</div>

<style>
	.sub-event {
		height: 100%;
	}

	.sub-event .only-event-admin {
		display: none;
	}

	.sub-event.event-admin .only-event-admin {
		display: initial;
	}

	.sub-event .cover {
		position: fixed;

		height: 100%;
		width: 100%;
		top: 0;

		background-color: rgb(40, 40, 40);
		background-repeat: no-repeat;
		background-size: cover;
		background-position: 50% 50%;

		overflow: hidden;

		box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);

		transition: top 0.7s cubic-bezier(0.19, 1, 0.22, 1);
	}

	.sub-event .cover.hide {
		top: -100%;
	}

	.sub-event .cover .dim {
		height: 100%;
		width: 50%;

		background-image: url("img/cover3.jpg");
		background-repeat: no-repeat;
		background-size: cover;
		background-position: 50% 50%;
		transition: opacity 0.5s;
	}

	.sub-event .cover .cont {
		height: 100%;
		width: 100%;
	}

	.sub-event .cover .shadow {
		position: absolute;
		
		height: 30rem;
		width: 100%;
		
		background: black;
		
		bottom: -30rem;
		left: 0;
		
		box-shadow: 0 0 30rem rgba(0, 0, 0, 1);
	}

	.sub-event .cover .left-corner {
		position: absolute;
		bottom: 1.5em;
		left: 1.5em;
		max-width: 70%;
	}

	.sub-event .cover .left-corner .date,
	.sub-event .cover .left-corner .location {
		font-size: 0.8em;
		margin-top: 0.4em;
	}

	.sub-event .cover .left-corner .title {
		font-size: 3em;
		font-weight: bold;
		margin-top: 0.5rem;
	}

	.sub-event .cover .left-corner .tip {
		font-size: 1em;
		margin-top: 1rem;
		opacity: 0.4;
	}

	@media only screen and (min-width: 1024px) {
		.sub-event .cover .left-corner {
			bottom: 2em;
			left: 2em;

			font-size: 140%;
		}
	}

	.sub-event>.cont {
		position: relative;

		width: 100%;
		height: 100%;

		overflow-y: auto;
		overflow-x: hidden;

		opacity: 0;
		background: rgba(251, 251, 251, 1);
		color: rgba(70, 70, 70, 1);

		transition: opacity 0.3s;

		text-align: center;
	}

	.sub-event>.cont.show {
		opacity: 1;
	}

	.sub-event>.cont .title {
		position: relative;

		text-align: center;
		font-size: 2.4em;
		font-weight: bold;

		margin-bottom: 1rem;
		padding: 0 2rem;

	    word-break: break-all;
	}

	.sub-event>.cont .date,
	.sub-event>.cont .location {
		display: inline-block;
		color: white;
		
		padding: 0.5rem 0.6rem;
		border-radius: 4px;
		border: 1px solid rgba(0, 0, 0, 0.08);
		
		background: #bdc3c7;
		margin-right: 0.3rem;
		margin-top: 0.3rem;
	}

	.sub-event>.cont .info-box {
		position: relative;
		padding: 3rem 4rem 4rem;
	}
	
	.sub-event>.cont .tagbox {
		margin-top: 1rem;
	}

	.sub-event>.cont .descr {
		font-size: 1.2em;
		text-align: left;
		margin-top: 2rem;
		line-height: 1.7;

	    word-break: break-all;
	}

	.sub-event>.cont .descr.collapse {
		height: 15rem;
		overflow: hidden;
	}

	.sub-event>.cont .col-shadow {
		position: absolute;
		bottom: 0; left: 0;

		display: none;

		padding: 1.5rem 0;
		width: 100%;
		background: white;

		pointer-events: none;

		box-shadow: 0 0 50px rgba(0, 0, 0, 0.04);
	}

	.sub-event>.cont .descr.collapse+.col-shadow {
		display: block;
	}

	.sub-event>.cont .show-more-btn {
		pointer-events: auto;
		
		font-weight: bold;

		width: 100%;

		color: rgba(100, 100, 100, 0.7);
		cursor: pointer;

		text-align: center;
	}

	.sub-event>.cont .show-more-btn:hover {
		color: rgba(100, 100, 100, 1);
	}

	.sub-event>.cont .scover {
		position: relative;
		
		width: 100%;
		height: 20rem;

		border-bottom: 1px solid rgba(0, 0, 0, 0.08);

		background-repeat: no-repeat;
		background-size: cover;
		background-position: 50% 50%;
	}

	.sub-event>.cont .toolbar {
		margin-bottom: 1rem;
		text-align: right;
		font-size: 1.3rem;
	}

	.sub-event>.cont .toolbar .toolbtn {
		margin-left: 0.5rem;
		color: rgb(120, 120, 120);
		cursor: pointer;

		transition: color 0.3s;
	}

	.sub-event>.cont .toolbar .toolbtn:hover {
		color: rgb(150, 150, 150);
	}

	.sub-event>.cont .toolbar .toolbtn.text {
		font-size: 1rem;
		font-weight: bold;
		color: rgb(150, 150, 150);
	}

	.sub-event>.cont .toolbar .toolbtn.text:hover {
		font-size: 1rem;
		font-weight: bold;
		color: rgb(180, 180, 180);
	}
	
	.sub-event>.cont .view-cover-btn {
		position: absolute;
		left: 0;
		top: 0;
		
		border-radius: 4px 0 4px 0 !important;
	}
	
	.sub-event>.cont .detail {
		word-wrap: break-word;
		
		margin-top: 1rem;
		text-align: left;
		
		line-height: 1.5;
	}

	.sub-event>.cont .bmap {
		width: 100%;
		height: 30rem;
		pointer-events: none;
	}

	.sub-event>.cont .cont-box {
		display: inline-block;

		width: 60rem;
		max-width: 90%;

		text-align: center;
		margin-top: 2rem;

		padding-bottom: 2rem;
	}

	.sub-event>.cont .box {
		position: relative;

		width: 100%;

		background: white;
		border-radius: 4px;
		/*box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);*/
		border: 1px solid rgba(0, 0, 0, 0.08);
		overflow: hidden;

		transition: opacity 0.3s;
	}

	.sub-event>.cont .sub-title {
		color: #4C4C4C;
		opacity: 0.5;
		font-size: 1.1em;
		text-align: left;
	}

	.sub-event>.cont .apply-prompt {
		color: #696969;
		font-size: 1.3em;
		font-weight: bold;
	}

	.sub-event>.cont .box-set .box {
		border-radius: 0;
	}

	.sub-event>.cont .box-set .box:first-child {
		border-radius: 4px 4px 0 0;
	}

	.sub-event>.cont .box-set .box:last-child {
		border-radius: 0 0 4px 4px;
	}

	.sub-event>.cont .box.btn:hover {
		opacity: 0.8;
		cursor: pointer;
	}

	.sub-event>.cont .box.btn:active {
		opacity: 1;
	}

	.sub-event>.cont .box.pad {
		padding: 2rem;
	}

	.sub-event>.cont .box.btn {
		padding-left: 0;
		padding-right: 0;
		transition: background 0.3s, opacity 0.3s;
	}

	.sub-event>.cont .disabled .box.btn:not(.always-enable),
	.sub-event>.cont .box.btn.disabled {
		color: #D9D9D9 !important;
		background: #B3B3B3 !important;
		cursor: default;
		/* pointer-events: none; */
	}

	.sub-event>.cont .disabled .box.btn:not(.always-enable):hover,
	.sub-event>.cont .box.btn.disabled:hover {
		opacity: 1;
	}

	@media only screen and (max-width: 640px) {
		.sub-event>.cont .cont-box {
			max-width: 100%;
			margin-top: -1px;
			padding-bottom: 1rem;
		}
		
		.sub-event>.cont .box {
			border-left: 0;
			border-right: 0;
			border-radius: 0;
		}

		.sub-event>.cont .box-set .box:last-child {
			border-radius: 0;
		}
		
		.sub-event>.cont .view-cover-btn {
			border-top-left-radius: 0 !important;
		}
		
		.sub-event>.cont .box.pad {
			padding: 2rem;
		}

		.sub-event>.cont .scover {
			height: 15rem;
		}

		.sub-event>.cont .title {
			font-size: 1.7em;
		}

		.sub-event>.cont .info-box {
			padding: 2rem;
		}

		.sub-event>.cont .descr {
			font-size: 1.05em;
		}
	}
</style>

<script>
	function init(main, args, show, cont) {
		require([
			"com/env", "com/util", "com/event",
			"com/xfilt", "com/login", "com/map",
			"com/lang", "com/avatar", "com/colstat",
			"com/formi", "com/comment", "com/club",
			"com/tagbox", "com/thumbview", "com/share",
			"com/popselect", "com/tip"
		], function (
			env, util, event,
			xfilt, login, map,
			lang, avatar, colstat,
			formi, comment, club,
			tagbox, thumbview, share,
			popselect, tip
		) {
			if (!args || !args.length) {
				util.emsg("$front.sub.event.no_euid");
				return;
			}

			var euid = parseInt(args[0]);
			var cont = main.children(".cont");

			if (isNaN(euid)) {
				util.emsg("$front.sub.event.illegal_euid");
				return;
			}

			var tbar = env.get("tbar");
			var m = lang.msg;

			tbar.setTitle("loading");

			util.scroll(cont, function (n) {
				if (n > 0) {
					tbar.showBanner();
				} else {
					tbar.hideBanner();
				}
			}, undefined, undefined, foci.config.banner_min_scroll);

			// modules
			var display = {};
			var cover = main.children(".cover");

			display.render = function (info) {
				var parsed = event.parseInfo(info, { max_title_len: Infinity });
				var cont = main.children(".cont");

				tbar.setTitle(info.title, parsed.date);

				cover.find(".title").html(parsed.title);
				cover.find(".date span").html(parsed.date);

				// cover.css("background-image", "url('" + parsed.cover + "')");
				util.bgimg(cover, util.nothumb(parsed.cover));

				cover.css("color", "#E6E6E6");

				main.children(".loader").removeClass("active");

				cont.find(".scover").css("background-image", "url('" + parsed.cover + "')");
				cont.find(".title").html(parsed.title);
				cont.find(".descr").html(parsed.descr);
				// cont.find(".date span").html(parsed.date);

				cont.find(".setting-toolbtn").click(function () {
					util.jump("#profile//new/" + euid);
				});

				share.popup(cont.find(".share-toolbtn"),
							new share.ShareObj(
								window.location.origin + window.location.hash,
								parsed.title + " - Foci",
								util.short(parsed.descr_text, 256),
								util.absurl(parsed.cover)
							),
							{});

				popselect.init(cont.find(".more-toolbtn"), [
					{
						cont: "Report"
					},

					{
						cont: "Issue"
					}
				]);

				thumbview.init(cont.find(".descr"));
				
				cont.find(".view-cover-btn").click(function () {
					if (!show_cover) {
						util.jump("#event/" + euid + "/true");
						show_cover = true;
					}
					
					showCover();
					
					setTimeout(function () {
						util.emsg("You can use the current url to open the cover again", "info");
					}, 1000);
				});
				
				// if (!parsed.favtag.length) {
				// 	cont.find(".tagbox").css("display", "none");
				// } else {
				// 	env.favtag(function (tags) {
				// 		var tgbox = tagbox.init(cont.find(".tagbox"), tags, {
				// 			init: parsed.favtag
				// 		});
				// 	});
				// }
				
				var tgbox = null;
				var show_map = parsed.has_location;
				
				env.favtag(function (tags) {
					tgbox = tagbox.init(cont.find(".tagbox"), tags, {
						init: parsed.favtag
					});
					
					parsed.location(function (addr) {
						cover.find(".location span").html(addr);
						// cont.find(".location span").html(addr);
						
						if (show_map) {
							tgbox.addTrivial({
								name: "<span><i class='map outline icon'></i>" + addr + "</span>",
								style: "green border"
							});
						} else {
							tgbox.addTrivial({
								name: "<span><i class='world icon'></i>Online</span>",
								style: "purple border"
							});
						}
					});
					
					tgbox.addTrivial({
						name: "<span><i class='calendar outline icon'></i>" + parsed.date + "</span>",
						style: "blue border"
					});
				});

				cont.find(".detail").html(parsed.detail);

				cont.find(".show-more-btn").click(function () {
					cont.find(".descr").removeClass("collapse");
				});

				if (parsed.descr.length > 256) {
					cont.find(".descr").addClass("collapse");
				}

				if (!show_map) {
					cont.find(".bmap-cont").remove();
				} else {
					map.embed(main.find(".bmap"), function (bmap) {
						if (parsed.loclng && parsed.loclat)
							bmap.set(parsed.loclng, parsed.loclat, 15);
					}, { initPos: false, canMark: false });

					cont.find(".bmap-box").dimmer({ on: "hover" });

					cont.find(".bmap-box .view-btn").click(function () {
						map.init({
							init_lng: parsed.loclng,
							init_lat: parsed.loclat,
							view: true, prompt: "loading address"
						});
					});
				}

				var ava = cont.find(".org");
				var fill = ava.children();

				var size, club_size;

				switch (info.org.length) {
					case 1: size = "5em"; club_size = "4.5em"; break;
					case 2: size = "4em"; club_size = "3.5em"; break;
					default: size = "4em"; club_size = "3.5em";
				}

				for (var i = 0; i < parsed.org.length; i++) {
					util.userInfo(parsed.org[i], null, null, function (suc, dat) {
						if (!suc) {
							dat = null;
						}

						avatar.init(ava, dat, {
							size: size, show_name: true
						});

						fill.remove();
					});
				}
				
				var club_set = cont.find(".club-set");
				
				function loadClub(dat) {
					club.list(club_set, null, {
						max_count: 3,
						type: "event",
						
						init: dat,
						
						entry: {
							margin: "0 1.5rem 0 0",
							size: club_size
						}
					});
				}
				
				var club_info = new Array(parsed.org_club.length);
				var loaded = 0;
				
				for (var i = 0; i < parsed.org_club.length; i++) {
					(function (i) {
						foci.get("/club/info", { cuid: parsed.org_club[i] }, function (suc, dat) {
							if (suc) {
								club_info[i] = dat;
							} else {
								util.emsg(dat);
								club_info[i] = { cuid: parsed.org_club[i] };
							}
							
							loaded++;
							
							if (loaded == parsed.org_club.length) {
								loadClub(club_info);
							}
						});
					})(i);
				}
				
				if (!i) {
					loadClub([]);
				}

				function getRForm(session, type, cb) {
					foci.encop(session, {
						int: "event",
						action: "rform",
						euid: euid,
						type: type
					}, cb);
				}

				function apply(session, type, cb) {
					getRForm(session, type, function (suc, dat) {
						if (suc) {
							var next = function (form, hide_form) {
								foci.encop(session, {
									int: "event",
									action: "apply",
									euid: euid,
									type: type,
									form: form
								}, function (suc, dat) {
									if (suc) {
										util.suc(true, "Your application has been sent");
									} else {
										util.emsg(dat);
									}

									cb(suc);
									hide_form(suc);
								});
							};

							if (dat) {
								formi.modal(util.json(dat), {
									uid: "apply." + euid + "." + type,
									submit: next,
									cancel: function () {
										cb(false);
									}
								});
							} else {
								next(null, function () {});
							}
						} else {
							util.emsg(dat);
							if (cb) cb(false);
						}
					});
				}

				function setAppPrompt(msg) {
					main.find(".apply-prompt").html(msg);
				}

				function disableApp(msg) {
					setAppPrompt(msg || m("$front.sub.event.thank_you"));
					main.find(".app-box").addClass("disabled");
					// main.find(".apply-partic").addClass("disabled");
				}

				function refreshAppBlock(session) {
					var uuid = session.getUUID();
					var is_org = info.org.indexOf(uuid) != -1;

					setAppPrompt("Apply for");
					main.find(".app-box").removeClass("disabled");

					if (session.isAdmin() || is_org) {
						main.find(".apply-setting").css("display", "").click(function () {
							util.jump("#profile//new/" + euid);
						});

						main.addClass("event-admin");
					}
					
					if (is_org) {
						// organizer

						setAppPrompt(m("$front.sub.event.organize"));
						main.find(".apply-staff").remove();
						main.find(".apply-partic").remove();

						main.find(".apply-appcent").css("display", "").click(function () {
							util.jump("#appcent/" + euid);
						});

						var termbtn = main.find(".apply-terminate").css("display", "").click(function () {
							util.jump("#termev/" + euid);
						}); // .addClass("disabled");

						if (info.state > 1 || info.end && info.end > new Date().getTime())
							termbtn.addClass("disabled");

						if (!info.apply_open) {
							disableApp("Enable application in <a href='#profile//new/" + euid + "/apply'>event settings</a>");
						}
					} else {
						if (info.state > 1) {
							disableApp("Event ended");
						} else if (!info.apply_open) {
							disableApp("Application disabled");
						} else {
							function checkRealname(cb) {
								if (info.apply_only_realname) {
									env.user(function (info) {
										if (!info.realname) {
											// not realname
											util.ask("This event requires real-name authentication. Do you want to request an authentication now?",
													 function (ans) {
													     if (ans) {
															 util.jump("#setting/user/realname");
														 }
													 });
										} else {
											cb();
										}
									});
								} else cb();
							}

							if (typeof info.apply_staff_lim === "number" &&
								info.apply_staff_num >= info.apply_staff_lim) {
								tip.init(main.find(".apply-staff").addClass("disabled"), "Application full", "top center", {
									on: "hover",
									auto: false
								});
							} else {
								main.find(".apply-staff").click(function () {
									checkRealname(function () {
										main.find(".apply-staff .loader").addClass("active");

										apply(session, "staff", function (suc) {
											main.find(".apply-staff" + " .loader").removeClass("active");
											if (suc) disableApp();
										});
									});
								});
							}

							if (typeof info.apply_partic_lim === "number" &&
								info.apply_partic_num >= info.apply_partic_lim) {
								tip.init(main.find(".apply-partic").addClass("disabled"), "Application full", "top center", {
									on: "hover",
									auto: false
								});
							} else {
								main.find(".apply-partic").click(function () {
									checkRealname(function () {
										main.find(".apply-partic .loader").addClass("active");

										apply(session, "partic", function (suc) {
											main.find(".apply-partic" + " .loader").removeClass("active");
											if (suc) disableApp();
										});
									});
								});
							}
						}
					}
				}

				if (env.session()) {
					refreshAppBlock(env.session());
					foci.encop(env.session(), {
						int: "event",
						action: "view",
						euid: euid
					}, function () {});
				} else {
					var prompt = $(m("$front.sub.event.login_first"));
					disableApp(prompt);
					prompt.find("a").click(function () {
						login.session(function (session) {
							if (session) refreshAppBlock(session);
						});
					});
				}

				var comm = comment.init(main.find(".comment"), euid, {
					state: info.state,
					disable_prompt: "event not ended yet"
				});

				util.scrollBottom(cont, 5, function () {
					comm.more();
				});
			};
			
			util.eventInfo(euid, function (dat) { display.render(dat); },
						   null, function (suc) { show(suc); });

			// util.blur(main.find(".dim"), 10);

			function hideCover(quick) {
				if (quick === true)
					main.find(".cover").css("display", "none");
				else
					main.find(".cover").addClass("hide");

				setTimeout(function () {
					tbar.setStyle("");
					$("body").addClass("padding-tbar");

					util.nextTick(function () {
						cont.addClass("show");
					});
				}, 400);
			}
			
			function showCover() {
				main.find(".cover").css("display", "");
				main.find(".cover").addClass("hide");
				
				setTimeout(function () {
					main.find(".cover").removeClass("hide");
					
					tbar.setStyle("simple");
					$("body").removeClass("padding-tbar");
				}, 300);
			}

			main.find(".cover").click(hideCover);

			var show_cover = false;

			if (args[1] !== "true") {
				hideCover(true);
			} else {
				show_cover = true;
				
				cover.ready(function () {
					tbar.setStyle("simple");
					$("body").removeClass("padding-tbar");
				});
			}
		});
	}
</script>
